# 艺术品接口 Postman 测试集合使用说明

## 概述

这个 Postman 测试集合包含了艺术品管理系统的完整 API 测试，涵盖了所有 CRUD 操作、边界测试、缓存测试和性能测试。

## 文件结构

- `postman_collection_artworks.json` - 主要的测试集合文件
- `postman_artworks_使用说明.md` - 本使用说明文档

## 环境配置

### 1. 导入测试集合

1. 打开 Postman
2. 点击 "Import" 按钮
3. 选择 `postman_collection_artworks.json` 文件
4. 导入成功后，你会在左侧看到 "艺术品接口测试集合"

### 2. 配置环境变量

在导入集合后，需要配置以下环境变量：

| 变量名 | 默认值 | 说明 |
|--------|--------|------|
| `baseUrl` | `http://localhost:3000` | API 服务器地址 |
| `token` | 空 | 用户认证令牌（登录后自动设置） |
| `artworkId` | 空 | 艺术品ID（创建后自动设置） |
| `artistId` | 空 | 艺术家ID |

## 测试用例说明

### 1. 用户认证

#### 用户登录获取Token
- **目的**: 获取访问受保护接口的认证令牌
- **方法**: POST
- **路径**: `/auth/login`
- **请求体**:
```json
{
  "username": "admin",
  "password": "admin123"
}
```
- **测试**: 验证登录成功并自动保存 token 到环境变量

### 2. 获取艺术品列表

#### 获取所有艺术品列表 - 默认分页
- **目的**: 测试获取艺术品列表的基本功能
- **方法**: GET
- **路径**: `/artworks`
- **测试**: 
  - 验证状态码为 200
  - 验证响应为数组格式
  - 验证每个艺术品包含必要字段（id, title, artist）

#### 获取艺术品列表 - 指定分页参数
- **目的**: 测试分页功能
- **方法**: GET
- **路径**: `/artworks?page=1&pageSize=10`
- **测试**: 验证返回数量不超过 pageSize

#### 按艺术家ID筛选艺术品
- **目的**: 测试按艺术家筛选功能
- **方法**: GET
- **路径**: `/artworks?artist_id=1`
- **测试**: 验证所有返回的艺术品都属于指定艺术家

#### 无效的艺术家ID
- **目的**: 测试参数验证
- **方法**: GET
- **路径**: `/artworks?artist_id=-1`
- **测试**: 验证返回 400 错误和正确的错误信息

#### 无效的分页参数
- **目的**: 测试边界值处理
- **方法**: GET
- **路径**: `/artworks?page=0&pageSize=-5`
- **测试**: 验证使用默认值处理无效参数

### 3. 获取艺术品详情

#### 获取艺术品详情 - 成功
- **目的**: 测试获取艺术品详情功能
- **方法**: GET
- **路径**: `/artworks/1`
- **测试**: 
  - 验证状态码为 200
  - 验证响应包含完整信息（title, artist, collection, images）
  - 自动保存艺术品ID到环境变量

#### 获取艺术品详情 - 不存在
- **目的**: 测试不存在的艺术品处理
- **方法**: GET
- **路径**: `/artworks/99999`
- **测试**: 验证返回 404 错误

#### 获取艺术品详情 - 无效ID
- **目的**: 测试参数验证
- **方法**: GET
- **路径**: `/artworks/abc`
- **测试**: 验证返回 400 错误

### 4. 创建艺术品

#### 创建艺术品 - 成功（使用artist_id）
- **目的**: 测试创建艺术品的基本功能
- **方法**: POST
- **路径**: `/artworks`
- **请求体**: 包含完整的艺术品信息
- **测试**: 
  - 验证状态码为 200
  - 验证响应包含创建的艺术品信息
  - 验证多图片数组正确保存
  - 自动保存新创建的艺术品ID

#### 创建艺术品 - 使用artist_name
- **目的**: 测试使用艺术家名称创建艺术品
- **方法**: POST
- **路径**: `/artworks`
- **测试**: 验证自动创建艺术家并关联艺术品

#### 创建艺术品 - 缺少必要参数
- **目的**: 测试参数验证
- **方法**: POST
- **路径**: `/artworks`
- **测试**: 验证返回 400 错误

#### 创建艺术品 - 无效图片URL
- **目的**: 测试图片URL验证
- **方法**: POST
- **路径**: `/artworks`
- **测试**: 验证返回 400 错误

### 5. 更新艺术品

#### 更新艺术品 - 成功
- **目的**: 测试更新艺术品功能
- **方法**: PUT
- **路径**: `/artworks/{id}`
- **测试**: 
  - 验证状态码为 200
  - 验证响应包含更新后的信息
  - 验证价格、库存、销售状态等字段正确更新

#### 更新艺术品 - 不存在
- **目的**: 测试更新不存在艺术品的处理
- **方法**: PUT
- **路径**: `/artworks/99999`
- **测试**: 验证返回错误状态码

### 6. 删除艺术品

#### 删除艺术品 - 成功
- **目的**: 测试删除艺术品功能
- **方法**: DELETE
- **路径**: `/artworks/{id}`
- **测试**: 
  - 验证状态码为 200
  - 验证返回成功消息

#### 删除艺术品 - 不存在
- **目的**: 测试删除不存在艺术品的处理
- **方法**: DELETE
- **路径**: `/artworks/99999`
- **测试**: 验证返回错误状态码

### 7. 缓存测试

#### 测试列表缓存
- **目的**: 验证 Redis 缓存功能
- **方法**: GET
- **路径**: `/artworks`
- **测试**: 验证响应时间合理

#### 测试详情缓存
- **目的**: 验证艺术品详情缓存
- **方法**: GET
- **路径**: `/artworks/1`
- **测试**: 验证响应时间合理

### 8. 性能测试

#### 并发获取列表
- **目的**: 测试大量数据的处理性能
- **方法**: GET
- **路径**: `/artworks?page=1&pageSize=50`
- **测试**: 
  - 验证响应时间合理（< 2秒）
  - 验证响应大小合理（< 100KB）

## 运行测试

### 1. 准备工作

1. 确保后端服务器正在运行
2. 确保数据库连接正常
3. 确保 Redis 服务正在运行

### 2. 执行测试

1. **首先运行认证测试**:
   - 执行 "用户登录获取Token" 测试
   - 确保 token 已正确保存

2. **按顺序执行测试**:
   - 获取列表测试
   - 创建艺术品测试
   - 获取详情测试
   - 更新艺术品测试
   - 删除艺术品测试
   - 缓存和性能测试

### 3. 批量运行

可以使用 Postman 的 "Runner" 功能批量运行所有测试：

1. 点击 "Runner" 按钮
2. 选择 "艺术品接口测试集合"
3. 配置运行参数
4. 点击 "Run" 开始批量测试

## 测试数据说明

### 测试用的图片URL格式

所有测试中的图片URL都使用以下格式：
- `https://wx.oss.2000gallery.art/uploads/xxx.jpg`
- `/uploads/xxx.jpg`

### 测试用的艺术家数据

- 艺术家ID: 1
- 艺术家名称: "测试艺术家"

## 错误处理测试

测试集合包含了各种错误情况的测试：

1. **参数验证错误**:
   - 无效的ID参数
   - 缺少必要参数
   - 无效的图片URL

2. **业务逻辑错误**:
   - 访问不存在的资源
   - 权限不足（需要认证的接口）

3. **边界值测试**:
   - 无效的分页参数
   - 空数组处理

## 缓存机制测试

测试集合验证了以下缓存功能：

1. **列表缓存**:
   - 按页数和大小缓存
   - 按艺术家ID缓存

2. **详情缓存**:
   - 按艺术品ID缓存
   - 缓存过期时间（7天）

3. **缓存清理**:
   - 创建/更新/删除时清理相关缓存

## 性能指标

测试集合验证以下性能指标：

1. **响应时间**:
   - 列表查询: < 1秒
   - 详情查询: < 1秒
   - 大量数据查询: < 2秒

2. **响应大小**:
   - 大量数据查询: < 100KB

3. **并发处理**:
   - 支持多用户同时访问

## 注意事项

1. **测试顺序**: 某些测试依赖于前面测试的结果，请按顺序执行
2. **数据清理**: 测试会创建和删除数据，请确保在测试环境中运行
3. **环境变量**: 确保环境变量正确配置，特别是 baseUrl
4. **认证**: 某些测试需要有效的认证令牌
5. **数据库**: 确保数据库中有测试用的艺术家数据

## 故障排除

### 常见问题

1. **连接失败**:
   - 检查 baseUrl 配置
   - 确保服务器正在运行

2. **认证失败**:
   - 检查用户名密码
   - 确保认证接口正常工作

3. **数据库错误**:
   - 检查数据库连接
   - 确保测试数据存在

4. **缓存问题**:
   - 检查 Redis 连接
   - 确保 Redis 服务正在运行

### 调试技巧

1. **查看响应详情**: 在 Postman 中查看完整的响应信息
2. **检查环境变量**: 确保变量值正确设置
3. **查看控制台**: 检查服务器日志了解错误原因
4. **逐步测试**: 逐个运行测试用例定位问题

## 扩展测试

可以根据需要添加以下测试：

1. **更多边界值测试**
2. **并发测试**
3. **压力测试**
4. **安全性测试**
5. **兼容性测试**

## 更新维护

当 API 接口发生变化时，需要相应更新测试集合：

1. **更新请求参数**
2. **更新响应验证**
3. **添加新的测试用例**
4. **更新使用说明文档** 