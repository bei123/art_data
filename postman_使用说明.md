# 收藏接口 Postman 测试集合使用说明

## 📋 概述

这个Postman集合包含了艺术品收藏系统的完整API测试，涵盖了所有收藏相关的接口功能。

## 🚀 快速开始

### 1. 导入集合
1. 打开Postman
2. 点击 "Import" 按钮
3. 选择 `postman_collection_favorites.json` 文件
4. 导入完成后，你会看到 "收藏接口测试集合"

### 2. 配置环境变量
在集合中已经预设了以下变量：
- `baseUrl`: API基础URL (默认: http://localhost:3000)
- `token`: 用户认证token (会自动保存)
- `userId`: 用户ID (会自动保存)

### 3. 运行测试流程

#### 第一步：用户认证
1. 运行 "用户登录获取Token" 请求
2. 如果成功，token会自动保存到集合变量中
3. 后续所有请求都会自动使用这个token

#### 第二步：测试添加收藏
按顺序运行以下测试：
1. **添加艺术品收藏 - 成功** ✅
2. **添加数字艺术品收藏 - 成功** ✅
3. **添加版权商品收藏 - 成功** ✅
4. **添加收藏 - 缺少参数** ❌ (应该返回400)
5. **添加收藏 - 无效物品ID** ❌ (应该返回400)
6. **添加收藏 - 无效收藏类型** ❌ (应该返回400)
7. **添加收藏 - 物品不存在** ❌ (应该返回404)
8. **添加收藏 - 重复收藏** ❌ (应该返回400)

#### 第三步：测试获取收藏列表
1. **获取所有收藏列表 - 默认分页** ✅
2. **获取艺术品收藏列表** ✅
3. **获取数字艺术品收藏列表** ✅
4. **获取版权商品收藏列表** ✅
5. **获取收藏列表 - 自定义分页** ✅
6. **获取收藏列表 - 无效分页参数** ✅ (应该使用默认值)

#### 第四步：测试取消收藏
1. **取消艺术品收藏 - 成功** ✅
2. **取消数字艺术品收藏 - 成功** ✅
3. **取消版权商品收藏 - 成功** ✅
4. **取消收藏 - 无效物品ID** ❌ (应该返回400)
5. **取消收藏 - 无效收藏类型** ❌ (应该返回400)
6. **取消收藏 - 记录不存在** ❌ (应该返回404)

#### 第五步：测试认证
1. **添加收藏 - 无Token** ❌ (应该返回401)
2. **获取收藏列表 - 无效Token** ❌ (应该返回401)

## 📝 测试用例说明

### 添加收藏 (POST /favorites)
- **请求体格式**:
```json
{
  "itemId": 1,
  "itemType": "artwork"
}
```

- **支持的itemType**:
  - `artwork`: 艺术品
  - `digital_art`: 数字艺术品
  - `copyright_item`: 版权商品

### 取消收藏 (DELETE /favorites/:itemType/:itemId)
- **URL示例**: `/favorites/artwork/1`
- **参数**: itemType 和 itemId 都在URL路径中

### 获取收藏列表 (GET /favorites)
- **查询参数**:
  - `page`: 页码 (默认: 1)
  - `pageSize`: 每页数量 (默认: 10)
  - `itemType`: 收藏类型过滤 (可选)

## 🔧 自定义配置

### 修改API地址
1. 在集合变量中修改 `baseUrl`
2. 或者创建环境变量来管理不同环境的URL

### 修改测试数据
根据你的实际数据库数据，修改测试用例中的 `itemId` 值：
- 确保数据库中存在对应的艺术品、数字艺术品、版权商品记录
- 建议使用真实的ID进行测试

## 🐛 常见问题

### 1. 认证失败
- 确保先运行 "用户登录获取Token" 请求
- 检查登录接口是否正常工作
- 确认JWT_SECRET环境变量已设置

### 2. 数据库连接失败
- 确保数据库服务正在运行
- 检查数据库连接配置
- 确认数据库中存在相应的表和数据

### 3. Redis连接失败
- 确保Redis服务正在运行
- 检查Redis连接配置
- 缓存功能失败不会影响主要业务逻辑

### 4. 测试数据不存在
- 在运行测试前，确保数据库中有对应的测试数据
- 可以修改测试用例中的 `itemId` 为实际存在的ID

## 📊 测试结果解读

### 成功响应示例
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "item_id": 1,
      "item_type": "artwork",
      "title": "艺术品标题",
      "image_url": "图片URL",
      "favorite_time": "2024-01-01T00:00:00.000Z"
    }
  ],
  "pagination": {
    "total": 10,
    "page": 1,
    "pageSize": 10
  }
}
```

### 错误响应示例
```json
{
  "error": "错误信息描述"
}
```

## 🎯 最佳实践

1. **按顺序运行测试**: 先认证，再添加收藏，最后测试其他功能
2. **检查测试结果**: 每个测试都有相应的断言，确保响应符合预期
3. **清理测试数据**: 测试完成后可以手动清理测试数据
4. **监控性能**: 注意响应时间，确保在可接受范围内
5. **定期更新**: 根据API变更及时更新测试用例

## 📞 技术支持

如果遇到问题，请检查：
1. 服务器是否正常运行
2. 数据库连接是否正常
3. Redis服务是否可用
4. 网络连接是否正常
5. 环境变量是否正确配置 